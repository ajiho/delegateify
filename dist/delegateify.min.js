!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Delegateify=t()}(this,(function(){"use strict";var e=0;function t(t){return"__private_"+e+++"_"+t}function i(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var n={throw_Error(e){throw new Error(`Delegateify: ${e}`)},contains(e,t){for(let i=0;i<t.length;i++)if(-1===e.indexOf(t[i]))return!1;return!0},contains2:(e,t)=>t.every((t=>e.includes(t)))};let s=0;var r=t("namespace"),l=t("id"),o=t("scopedSelectorRegex"),a=t("listenersByType"),h=t("allListeners"),p=t("idKey"),u=t("pathKey"),c=t("stopPropagationKey"),d=t("stopImmediatePropagationKey"),f=t("captureListener"),v=t("bubbleListener"),y=t("listenerMatchesRootTarget"),b=t("listenerMatchesDelegateTarget"),m=t("listenerMatchesEventPhase"),P=t("executeListenersAtElement"),g=t("executeBubbleListener"),O=t("executeCaptureListener"),E=t("decorateEvent"),j=t("undecorateEvent"),w=t("getPath"),_=t("isScoped");function x(e,t){return null===e.selector&&t===this.element}function L(e,t){return t!==document&&t!==this.element&&null!==e.selector&&(e.isScoped?Element.prototype.matches.call(t,`[${i(this,p)[p]}="${i(this,l)[l]}"] `+e.selector):Element.prototype.matches.call(t,e.selector))}function N(e,t){return e.useCapture===t}function T(e,t,n,s){let r,l;e:for(let o=0;o<t.length&&(r=t[o],"click"===n.type&&!0===e.disabled||!i(this,y)[y](r,e)&&!i(this,b)[b](r,e)||!i(this,m)[m](r,s)||(n.matchedTarget=e,l=r.handler.call(e,n),!1===l&&(n.preventDefault(),n.stopPropagation()),!n[i(this,d)[d]]));o++);}function $(e){let t=i(this,a)[a][e.type];if(t||n.throw_Error(`_executeListeners 被调用以响应"${e.type}"，但我们没有监听它`),t.length){t=t.slice(),i(this,E)[E](e);let n="focus"!==e.type&&"blur"!==e.type,s=i(this,w)[w](e);e:for(let r=0;r<s.length&&t.length;r++){let l=s[r];if(i(this,P)[P](l,t,e,!1),e[i(this,d)[d]]||e[i(this,c)[c]])break e;if(!n)break e}}i(this,j)[j](e),e[i(this,u)[u]]=null}function S(e){let t=i(this,a)[a][e.type];if(t||n.throw_Error(`_executeListeners 被调用以响应${e.type},但我们没有监听它`),t.length){t=t.slice(),i(this,E)[E](e);let n=i(this,w)[w](e);e:for(let s=n.length-1;s>=0&&t.length;s--){let r=n[s];if(i(this,P)[P](r,t,e,!0),e[i(this,d)[d]]||e[i(this,c)[c]])break e}}i(this,j)[j](e)}function I(e){let t=this;e.stopPropagation=function(){this[i(t,c)[c]]=!0,Event.prototype.stopPropagation.call(this)},e.stopImmediatePropagation=function(){this[i(t,d)[d]]=!0,Event.prototype.stopImmediatePropagation.call(this)}}function C(e){e.stopPropagation=Event.prototype.stopPropagation,e.stopImmediatePropagation=Event.prototype.stopImmediatePropagation}function D(e){if(e[i(this,u)[u]])return e[i(this,u)[u]];let t=e.target;t.nodeType===Node.TEXT_NODE&&(t=t.parentNode);let n=t,s=[];for(;n&&n!==this.element;)s.push(n),n=n.parentNode;return s.push(this.element),e[i(this,u)[u]]=s,s}function k(e){return e&&i(this,o)[o].test(e)}return class{constructor(e){Object.defineProperty(this,_,{value:k}),Object.defineProperty(this,w,{value:D}),Object.defineProperty(this,j,{value:C}),Object.defineProperty(this,E,{value:I}),Object.defineProperty(this,O,{value:S}),Object.defineProperty(this,g,{value:$}),Object.defineProperty(this,P,{value:T}),Object.defineProperty(this,m,{value:N}),Object.defineProperty(this,b,{value:L}),Object.defineProperty(this,y,{value:x}),this.element=void 0,Object.defineProperty(this,r,{writable:!0,value:"delegateify"}),Object.defineProperty(this,l,{writable:!0,value:void 0}),Object.defineProperty(this,o,{writable:!0,value:/^\s*(>|:scope\s*>)/}),Object.defineProperty(this,a,{writable:!0,value:void 0}),Object.defineProperty(this,h,{writable:!0,value:[]}),Object.defineProperty(this,p,{writable:!0,value:`__${i(this,r)[r]}Id__`}),Object.defineProperty(this,u,{writable:!0,value:void 0}),Object.defineProperty(this,c,{writable:!0,value:`_${i(this,r)[r]}PropagationStopped`}),Object.defineProperty(this,d,{writable:!0,value:`_${i(this,r)[r]}ImmediatePropagationStopped`}),Object.defineProperty(this,f,{writable:!0,value:void 0}),Object.defineProperty(this,v,{writable:!0,value:void 0}),this.element="string"==typeof e?document.querySelector(e):e,i(this,a)[a]=Object.create(null),i(this,f)[f]=i(this,O)[O].bind(this),i(this,v)[v]=i(this,g)[g].bind(this),i(this,l)[l]=s++,i(this,u)[u]=`_${i(this,r)[r]}Path${i(this,l)[l]}`}on(e,t,s,r){"function"==typeof t&&(r=s,s=t,t=null),"function"!=typeof s&&n.throw_Error("无法使用非函数处理程序添加侦听器"),t||(t=null),void 0===r&&(r="focus"===e||"blur"===e);let o=null,u=e.indexOf(".");-1!==u&&(o=e.slice(u+1).split("."),e=e.slice(0,u));let c=i(this,a)[a][e];c||(c=i(this,a)[a][e]=[],this.element.addEventListener(e,i(this,f)[f],!0),this.element.addEventListener(e,i(this,v)[v],!1));let d=i(this,_)[_](t);d&&(t=t.replace(scopedSelectorRegex,">"),this.element.setAttribute(i(this,p)[p],i(this,l)[l]));const y={eventName:e,handler:s,namespaces:o,selector:t,useCapture:r,isScoped:d};c.push(y),i(this,h)[h].push(y)}off(e,t,s,r){"function"==typeof t&&(r=s,s=t,t=null),void 0===e&&(e=null),void 0===t&&(t=null),void 0===s&&(s=null),void 0===r&&(r=null);let l,o,p=null;if(e){let t=e.indexOf(".");-1!==t&&(p=e.slice(t+1).split("."),e=e.slice(0,t))}""===e&&(e=null);let u=i(this,h)[h];for(var c=0;c<u.length;c++)if(l=u[c],(null===e||l.eventName===e)&&(null===t||l.selector===t)&&(null===s||l.handler===s)&&(null===r||l.useCapture===r)&&(null===p||l.namespaces&&n.contains(l.namespaces,p)))if(i(this,h)[h].splice(c,1),c--,i(this,a)[a][l.eventName]||n.throw_Error(`缺少 ListenersByType 的${l.eventName}`),o=i(this,a)[a][l.eventName].indexOf(l),-1!==o){var d=i(this,a)[a][l.eventName];d.splice(o,1),0===d.length&&(this.element.removeEventListener(l.eventName,i(this,f)[f],!0),this.element.removeEventListener(l.eventName,i(this,v)[v],!1),i(this,a)[a][l.eventName]=null)}else n.throw_Error("事件存在于allEvents中，但不存在于listenersByType中");return this}destroy(){this.destroyed||(this.off(),i(this,a)[a]=null,i(this,h)[h]=null,this.element=null,this.destroyed=!0)}dispatch(e,t){void 0===(t=t||{}).bubbles&&(t.bubbles=!0),void 0===t.cancelable&&(t.cancelable=!0);const i=new CustomEvent(e,t);return this.element.dispatchEvent(i),i}}}));
//# sourceMappingURL=delegateify.min.js.map
